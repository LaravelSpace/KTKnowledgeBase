## MySQL配置

与其它数据库不同，MySQL服务器可以在不同的SQL模式下运行，并且可以针对不同的客户端以不同的方式应用这些模式，具体取决于sql_mode系统变量的值。

在MySQL中，SQL模式常用来解决下面几类问题：

- 通过设置sql_mode，可以完成不同严格程度的数据校验，有效地保障了数据的准确性。
- 在不同数据库之间进行数据迁移之前，设置sql_mode可以使MySQL中的数据更方便地迁移到目标数据库中。
- 通过设置sql_mode为ANSI模式，可以保证大多数SQL符合标准的SQL语法，使不同数据库之间进行迁移时，不需要进行较大的修改。

### sql_mode系统变量的常用值

##### TRICT_ALL_TABLES和STRICT_TRANS_TABLES

如果将sql_mode的值设置为TRICT_ALL_TABLES和STRICT_TRANS_TABLES，那么MySQL将启用严格模式。简单来说严格模式就是MySQL自身对数据进行的严格校验，例如格式、长度和类型等。

在严格模式下，MySQL服务器会更加严格地对待接收到的不合格数据，它不会把这些不合格的数据转换为最为接近的有效值，而是会拒绝接收它们。

##### TRADITIONAL

类似于严格模式，但是对于插入的不合格值会给出错误而不是警告。可以应用在事务表和非事务表，用于事务表时，只要出现错误就会立即回滚。

如果你使用的是非事务存储引擎，建议不要把sql_mode值设置为TRADITIONAL，因为出现错误前进行的操作不会回滚，这样会导致操作只进行了一部分。

##### ANSI_QUOTES

MySQL服务器会把双引号识别为一个标识符引用字符，而不是字符串的引号字符。所以在启用ANSI_QUOTES时，不能用双引号来引用字符串。

##### PIPES_AS_CONCAT

会让MySQL服务器把`||`当成一个标准的SQL字符串连接运算符，而不会把它当成是OR运算符的同义词。

在Oracle等数据库中，`||`被视为字符串的连接操作符，所以在其它数据库中含有`||`操作符的SQL在MySQL中将无法执行，为了解决这个问题，MySQL提供了这个值。

##### ANSI

会同时启用ANSI_QUOTES、PIPES_AS_CONCAT和其它的几个模式值，使MySQL服务器的行为比它的默认运行状态更接近于标准SQL。

### 系统变量

在MySQL数据库，变量分为系统变量和用户自定义变量。系统变量以@@开头，用户自定义变量以@开头。

服务器维护着两种系统变量，即全局变量（GLOBAL VARIABLES）和会话变量（SESSION VARIABLES）。全局变量影响MySQL服务的整体运行方式，会话变量影响具体客户端连接的操作。

每一个客户端成功连接服务器后，都会产生与之对应的会话。会话期间，MySQL服务实例会在服务器内存中生成与该会话对应的会话变量，这些会话变量的初始值是全局变量值的拷贝。

##### 查看系统变量

使用`SHOW GLOBAL VARIABLES; `命令查看MySQL中所有的全局变量信息。使用`SHOW SESSION VARIABLES;`命令查看与当前会话相关的所有会话变量以及全局变量。其中，SESSION 关键字可以省略。

##### 设置系统变量

服务器启动时，会将所有的全局变量赋予默认值。这些默认值可以在选项文件中或在命令行中对执行的选项进行更改。更改全局变量，必须具有SUPER权限。可以通过以下方法设置系统变量：

- 修改MySQL源代码，然后对MySQL源代码重新编译。
- 修改MySQL配置文件（mysql.ini或mysql.cnf），需要重启MySQL服务才会生效。
- 在MySQL服务运行期间，使用SET命令重新设置系统变量的值。如果没有指定修改全局变量还是会话变量，服务器会当作会话变量来处理。

需要注意的是，更改全局变量只影响更改后连接客户端的相应会话变量，而不会影响目前已经连接的客户端的会话变量（即使客户端执行SET GLOBAL语句也不影响）。对于修改全局变量之前连接的客户端只有在客户端重新连接后，才会影响到客户端。

客户端连接时，当前全局变量的值会对客户端的会话变量进行相应初始化。设置会话变量不需要特殊权限，但客户端只能更改自己的会话变量，而不能更改其它客户端的会话变量。

使用SET设置全局变量或会话变量成功后，如果MySQL服务重启，数据库的配置就又会重新初始化。一切按照配置文件进行初始化，全局变量和会话变量的配置都会失效。