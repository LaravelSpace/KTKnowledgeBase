## MySQL的存储引擎

| 存储引擎  | 描述                                                         |
| --------- | ------------------------------------------------------------ |
| ARCHIVE   | 用于数据存档的引擎，数据被插入后就不能在修改了，且不支持索引。 |
| CSV       | 在存储数据时，会以逗号作为数据项之间的分隔符。               |
| BLACKHOLE | 会丢弃写操作，该操作会返回空内容。                           |
| FEDERATED | 将数据存储在远程数据库中，用来访问远程表的存储引擎。         |
| InnoDB    | 具备外键支持功能的事务处理引擎                               |
| MEMORY    | 置于内存的表                                                 |
| MERGE     | 用来管理由多个MyISAM表构成的表集合                           |
| MyISAM    | 主要的非事务处理存储引擎                                     |
| NDB       | MySQL集群专用存储引擎                                        |

### InnoDB

MySQL5.5版本以后，默认存储引擎由MyISAM修改为InnoDB。

在SQL查询中可以将InnoDB类型的表与其他类型的表混合起来，甚至在同一个查询中也可以混合。

##### InnoDB的优势和不足

###### 支持事务

InnoDB最重要的一点。InnoDB还实现了SQL92标准所定义的4个隔离级别（READUNCOMMITTED，READCOMMITTED，REPEATABLEREAD和SERIALIZABLE）。

###### 灾难恢复

InnoDB通过commit、rollback、crash-recovery来保障数据的安全。crash-recovery就是指如果服务器因为硬件或软件的问题而崩溃，不管当时数据是怎样的状态，在重启MySQL后，InnoDB都会自动恢复到发生崩溃之前的状态，并回到用户离开的地方。

###### 行锁

InnoDB改变了MyISAM的锁机制，实现了行锁。虽然InnoDB的行锁机制是通过索引来完成的，但毕竟在数据库中99%的SQL语句都要使用索引来检索数据。行锁定机制也为InnoDB在承受高并发压力的环境下增强竞争力。

###### 缓冲处理

InnoDB提供了专门的缓存池，实现了缓冲管理，不仅能缓冲索引也能缓冲数据(MyISAM只缓存了索引)，常用的数据可以直接从内存中处理，比从磁盘获取数据处理速度要快。

InnoDB的表和索引在一个逻辑表空间中，表空间可以包含数个文件（或原始磁盘分区）。这与MyISAM表不同，比如在MyISAM表中每个表被保存在分离的文件中。InnoDB表可以是任何尺寸，即使在文件尺寸被限制为2GB的操作系统上。

###### 支持外键

InnoDB支持外键约束，检查外键、插入、更新和删除，以确保数据的完整性。在存储表中数据时每张表的存储都按主键顺序存放，如果没有显式地在定义表时指定主键，InnoDB会为每一行生成一个6字节的ROWID，并以此作为主键。

InnoDB实现外键引用这一重要特性，使在数据库端控制部分数据的完整性成为可能。虽然很多数据库系统调优专家都建议不要这样做，但是大部分情况下，在数据库端加外键控制仍然是成本最低的选择。

###### 适合需要大型数据库的网站

InnoDB是为处理巨大数据量时的最大性能设计，它的CPU效率可能是任何其他基于磁盘的关系数据库引擎所不能匹敌的。

当然，InnoDB存储引擎肯定也有缺点。相对于其它存储引擎来说，使用InnoDB存储引擎的读写效率稍差，且占用的数据空间相对较大。

### InnoDB的物理存储结构

使用InnoDB时，MySQL会在数据目录（Data）下创建一个名为ibdata1的10MB大小的自动扩展数据文件，以及两个名为ib_logfile0和ib_logfile1的5MB大小的日志文件。

InnoDB存储引擎和MyISAM不太一样，虽然也有.frm文件来存放表结构定义相关的元数据，但是表数据和索引数据是存放在一起的。至于是每个表单独存放还是所有表存放在一起，用户可以自己设置。

InnoDB的物理存储结构分为数据文件和日志文件两大部分。

#####  数据文件（表数据和索引数据）

InnoDB的表空间分为以下两种形式：

- 共享表空间，表数据和索引都存放在同一个表空间。默认的表空间文件就是上面所提到的MySQL初始化路径下的ibdata1文件。
- 独立表空间，每个表的数据和索引被存放在一个单独的.ibd文件中。

##### 日志文件

默认情况下，InnoDB存储引擎的数据目录下会有两个名为ib_logfile0和ib_logfile1的文件。在MySQL官方手册中将其称为InnoDB存储引擎的重做日志文件（redo log file）。

重做日志文件对InnoDB存储引擎至关重要。InnoDB可以通过重做日志将数据库宕机时已经完成但还没有来得及将数据写入磁盘的事务恢复，也能将所有部分完成并已经写入磁盘的未完成事务回滚，并且将数据还原，以此来保证数据的完整性。

### MyISAM

MyISAM存储引擎是MySQL中常见的存储引擎，曾（MySQL5.1及之前版本）是MySQL的默认存储引擎。

##### MyISAM的优势和不足

优势

- 数据紧凑存储，占用空间小，因此可获得更小的索引和更快的全表扫描性能。
- 访问速度快，对事务完整性没有要求或以SELECT、INSERT为主的应用基本上都可以使用这个引擎来创建表。
- 可以配合锁，实现操作系统下的复制备份。
- 支持全文检索（InnoDB在MySQL5.6版本以后也支持全文检索）。

不足

- 不支持事务的完整性和并发性。
- MyISAM表易损坏，灾难恢复性不佳，数据库宕机后无法安全恢复。
- 不支持行级锁，使用表级锁，并发性差。
- 只缓存索引，数据的缓存是利用操作系统缓冲区来实现的，可能会引发过多的系统调用，且效率不佳。

MyISAM对整张表加锁，而不是针对行。读取时会对需要读到的所有表加共享锁，写入时对表加排他锁。但是在表有读取查询的同时，也可以往表中插入新的记录（这被称为并发插入）。