## 技术负债(Technical debt)

又译技术债，设计负债(design debt)、代码负债(code debt)

为了加速软件开发，在应该采用最佳方案时进行了妥协，改用了短期内能加速软件开发的方案，从而给未来带来额外开发负担

必须付出额外的时间和精力持续修复之前的妥协所造成的问题及副作用，或是进行重构，把架构改善为最佳实现方式

但是这不一定是个绝对要规避的东西，一个项目拖不到更好的方案时，需要贷这样一笔技术债来加速一下进程，尽快上线让它运转起来也是有必要的

在知情的情况下，要不要欠技术债，欠下以后怎么还，多久还，也是一个开发战略，做技术开发绝对不是蒙头写代码那么简单

### 技术债的产生

##### 设计和架构

项目初期的设计只为了满足当前的需要，没有更多一步的考虑。随着项目复杂度增加，问题越来越多的暴露出来。当你下定决心进行重构的时候，产品经理或者项目经理告诉你，这个礼拜必须上线。

##### 代码

稍微欠点儿技术债的确可以加速开发速度，但前提是事后及时重写代码。如果只借不还，后果很危险。在不准确的代码上所花的每一分钟，都算是技术债的应付利息

代码方面产生技术债的原因很多，例如：

- 如期完工的压力，比如每周 996 都开发不完的任务。
- 神秘数字、混乱的命名、不准守代码规范。
- 不合适的设计，比如过度设计、业务发现大变化、抽象能力不足等。
- 试图以错误的方式提高效率。
- 工程师在解决一个 BUG 的时候，并没有找到 BUG 产生的根本原因，只是短视的规避。
- 试图减少测试提高效率，比如单元测试、集成测试、系统测试、白盒测试、黑盒测试不足。
- 初级工程师由于缺乏经验编写了低质量的代码也会导致代码债务的增加。
- 新人无法理解旧人所写代码，代码缺少传递性。

##### 测试

- 手工测试过多。
- 测试用例覆盖不够，导致一些本该解决的问题被隐藏。
- 没有完整的自动化测试流程，仅靠人工测试。
- 业务代码变化快，测试的用例修改不及时。

##### 项目工期压力

研发人员工作压力大，一方面需要不断的开发新的需求，另外一方面又需要维护前期遗漏的代码。研发人员就在开发，修复，加班，开发，修复，加班的循环当中，苦不堪言。

##### 技术债的后果

- 交付时间延长
- 开发和支持成本持续上升
- 可预测性较低
- 缺陷数量可观
- 爆发点不可逾期

#### 如何还债

##### 好的设计和架构

作为架构人员一定要对项目当下需求以及未来的需求能够做一个预见，避免随着项目复杂度提升导致后期重构的风险。选择合适的技术而不是最好的技术。遵从一些设计最基本的原则：模块化，轻耦合，无状态。模块可单独交付也可组合交付。

##### Code Review

Code Review 很重要，千万不要以时间或者其他原因放弃 Code Review。Code Review 工作可以在开始就将可能产生的债务清理掉。如果你能全款，为什么要选择贷款呢？

##### 质量保证

对从自己指尖敲下的每段代码负责，对编码的规范的严格执行，对代码效率的极致追求，对每个BUG追根溯源。这些都会在不知不觉的过程中减少技术债务的产生。

##### 严格测试

增加自动化测试覆盖率，通过自动化测试覆盖住流程，减少漏测的几率，并为后期偿还债务时可能需要的重构提供保障。无情的测试：越是仔细，全面的测试，越是有助于系统的健壮。

##### 定期的技术债务偿还

和项目经理或者产品经理协商一个迭代或者趁迭代的空隙，专门用于解决前期积累的技术债务。应用有债就还原则，将积累的技术债务按照优先级就行排序，将最需要解决的债务分配一些到迭代之中。分期偿还技术债，先偿还高息技术债。一方面可以清理债务，另一方面可以是开发人员得到一定程度的放松。提前偿还，相当于等额本金。

### 代码整洁之道

Bob大叔在其著作《代码整洁之道》的前言中引用了这样一幅漫画：

![p08](.\JiShuFuZhai_08.jpg)

使用漫画中的“每分钟爆粗数量”来衡量代码质量是个很有趣的玩笑，强调了代码的可读易懂等这样的“内在”质量属性。相对于满足需求规范这样的“外在”质量属性，“内在”的代码质量属性强调的是支持实现功能需求的代码内部结构的质量。《Sonar code quality testing essential》一书中从七个维度定义了代码的这种内在质量，Sonar开发团队上纲上线的戏称为开发人员七宗罪：

- 编码规范：是否遵守了编码规范，遵循了最佳实践。
- 潜在的BUG：可能在最坏情况下出现问题的代码，以及存在安全漏洞的代码。
- 文档和注释：过少（缺少必要信息）、过多（没有信息量）、过时的文档或注释。
- 重复代码：违反了 Don’tRepeat Yourself 原则。
- 复杂度：代码结构太复杂（如圈复杂度高），难以理解、测试和维护。
- 测试覆盖率：编写单元测试，特别是针对复杂代码的测试覆盖是否足够。
- 设计与架构：是否高内聚、低耦合，依赖最少。

## 参考

- [技术负债](https://baike.baidu.com/item/%E6%8A%80%E6%9C%AF%E8%B4%9F%E5%80%BA/17587713?fr=aladdin)
- [代码质量与规范，那些年你欠下的技术债](https://www.cnblogs.com/qcloud1001/p/9257269.html)
- [老程序员欠下技术债跑了，新来的不断还债能把公司耗死！](http://baijiahao.baidu.com/s?id=1599160912769877274&wfr=spider&for=pc)
- [如何处理技术债](https://www.jianshu.com/p/e532a7e4f768)
- [警惕呀，那深不见底的技术债！](https://www.sohu.com/a/167963698_720560)